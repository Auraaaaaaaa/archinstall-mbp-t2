# This is an example PKGBUILD file. Use this as a start to creating your own,
# and remove these comments. For more information, see 'man PKGBUILD'.
# NOTE: Please fill out the license field for your package! If it is unknown,
# then please put 'unknown'.

model=$(cat /sys/devices/virtual/dmi/id/product_name)
_model=$(echo $model|tr , _)
chip=$(lspci -d '14e4:*'|cut -d' ' -f 8|cut -b 4,5,6,7)
pkgname=(apple-t2-wifi-${_model})
pkgver=0.1
pkgrel=1
pkgdesc="Wifi firmware for $model, specific to the computer that firmware was selected for."
arch=("any")
url="https://github.com/jamlam/mbp-16.1-linux-wifi"
license=('unknown')
source=("wifi-fw/C-4364__s-B3/bali.trx"
        "wifi-fw/C-4364__s-B3/bali-X3.clmb"
	"wifi-fw/C-4364__s-B3/P-bali-X3_M-HRPN_V-u__m-7.7.txt")
md5sums=('SKIP'
         'SKIP'
         'SKIP')

prepare() {
	rm brcmfmac*||:
	cp -L *.trx "brcmfmac$chip-pcie.bin"
	cp -L *.clmb "brcmfmac$chip-pcie.clm_blob"
	cp -L *.txt "brcmfmac$chip-pcie.Apple Inc.-$model.txt"
}

package() {
	install -Dm644 -t $pkgdir/usr/lib/firmware/brcm/ "brcmfmac$chip-pcie.bin" "brcmfmac$chip-pcie.clm_blob" "brcmfmac$chip-pcie.Apple Inc.-$model.txt"
}
