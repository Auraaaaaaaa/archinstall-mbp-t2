# This is an example PKGBUILD file. Use this as a start to creating your own,
# and remove these comments. For more information, see 'man PKGBUILD'.
# NOTE: Please fill out the license field for your package! If it is unknown,
# then please put 'unknown'.

# Maintainer: Your Name <youremail@domain.com>
pkgname=t2-mbpfan
pkgver=r48.a7bfcf3
pkgrel=2
pkgdesc="A simple daemon to control fan speed on t2 Macs with patchched kernel."
arch=('x86_64')
url="https://github.com/networkException/mbpfan"
license=('GPL3')
makedepends=()
provides=('mbpfan')
conflicts=('mbpfan')
backup=('etc/mbpfan.conf')
source=("t2-mbpfan::git+https://github.com/networkException/mbpfan.git")
md5sums=('SKIP')

pkgver() {
	cd "$_pkgbase"
	( set -o pipefail
	  git describe --long 2>/dev/null | sed 's/\([^-]*-g\)/r\1/;s/-/./g' ||
	  printf "r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
	)
}

build() {
	cd "$pkgname"
	make
}

#check() {
#	cd "$pkgname"
#	make -k check
#}

package() {
	cd "$pkgname"
	install -Dm755 bin/mbpfan $pkgdir/usr/bin/mbpfan
	install -Dm755 mbpfan.conf $pkgdir/etc/mbpfan.conf
	install -Dm755 README.md $pkgdir/usr/share/doc/mbpfan/README.md
	install -Dm755 mbpfan.8.gz $pkgdir/usr/share/man/man8/mbpfan.8.gz
	install -Dm644 mbpfan.service $pkgdir/usr/lib/systemd/system/mbpfan.service
}
